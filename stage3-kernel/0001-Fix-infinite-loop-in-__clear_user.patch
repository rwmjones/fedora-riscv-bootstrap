From 9d2e9e619df7da4275f156aeef60e9bea1308c5e Mon Sep 17 00:00:00 2001
From: Andrew Waterman <waterman@cs.berkeley.edu>
Date: Tue, 23 Feb 2016 12:59:26 -0800
Subject: [PATCH] Fix infinite loop in __clear_user

(cherry picked from commit 77148ef248f72bb96b5cacffc0a69bca445de214)
---
 arch/riscv/lib/uaccess.S | 1 +
 1 file changed, 1 insertion(+)

diff --git a/arch/riscv/lib/uaccess.S b/arch/riscv/lib/uaccess.S
index e70f135..d7fdba3 100644
--- a/arch/riscv/lib/uaccess.S
+++ b/arch/riscv/lib/uaccess.S
@@ -82,6 +82,7 @@ ENTRY(__clear_user)
 	j 1b
 4: /* Edge case: remainder */
 	fixup sb, zero, (a0), 10f
+	addi a0, a0, 1
 	bltu a0, a3, 4b
 	li a0, 0
 	ret
-- 
2.9.3

